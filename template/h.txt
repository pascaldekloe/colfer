// Code generated by colf(1); DO NOT EDIT.
{{- range .}}{{/* package range */}}
// The compiler used schema file {{.SchemaFileList}} for package {{.Name}}.
{{- end}}

#include <stdint.h>
#include <stdlib.h>
{{- if .HasTimestamp}}
#include <time.h>
{{- end }}

{{with index . 0 -}}
// Upper boundary for octets in a Colfer serial.
#define COLFER_MAX ({{.SizeMax}})
{{- end}}

#ifdef __cplusplus
extern "C" {
#endif
{{- range .}}{{/* package range */}}

{{range .Structs}}
{{.DocText "// "}}
struct {{.NameNative}} {

{{- range .Fields}}
 {{- if ne .Index 0}}{{/* newline separator */}}
 {{end}}
 {{.DocText "\t// "}}
 {{- if not .TypeList}}
  {{- if eq .Type "bool"}}
	// {{.NameNative}} in bools bit-field;
  {{- else if eq .Type "timestamp"}}
	struct timespec

  {{- else if eq .Type "text"}}
	struct {
		{{.TypeNative}}* utf8;
		size_t len; // octet count
	}

  {{- else if .TypeRef}}
	struct {{.TypeRef.NameNative}}

  {{- else}}
	{{.TypeNative}}

  {{- end}}{{/* type match */}}
 {{- else}}{{/* is list */}}
  {{- if eq .Type "text"}}
	struct {
		struct {
			{{.TypeNative}}* utf8;
			size_t len; // octet count
		}* list;
		size_t len; // element count
	}

  {{- else if .TypeRef}}
	struct {
		struct {{.TypeRef.NameNative}}* list;
		size_t len; // element count
	}

  {{- else}}
	struct {
		{{.TypeNative}}* list;
		size_t len; // element count
	}

  {{- end}}{{/* type match */}}
 {{- end}}{{/* is list */}} {{.NameNative}}{{if ne .ElementCount 0}}[{{.ElementCount}}]{{end}};
{{- end}}{{/* field range */}}
{{- if .HasBool}}

	// Bit field for booleans.
	unsigned int bools;
{{- end}}
};

{{- if .HasBool}}
// Boolean fields of struct {{.NameNative}}.
{{- range .Fields}}{{if eq .Type "bool"}}
#define {{.NameNative}} (1 << {{.BoolIndex}})
{{- end}}{{end}}
{{- end}}{{/* has boolean */}}

// Marshal encodes o as Colfer at start, up to COLFER_MAX octets in size. A zero
// return signals that the data in o exceeds COLFER_MAX.
size_t
{{.NameNative}}_marshal(const struct {{.NameNative}}* o, void* start);

// Unmarshal decodes o as Colfer from start. The number of octets consumed is at
// least 3, and at most COLFER_MAX. A zero return signals malformed data. String
// fields are allocated including null terminator. Caller owns the memory.
size_t
{{.NameNative}}_unmarshal(struct {{.NameNative}}* o, const void* start);

{{end}}{{/* struct range */}}

{{- end}}{{/* package range */}}
#ifdef __cplusplus
} // extern "C"
#endif
