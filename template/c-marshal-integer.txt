	if (v{{.Index}} < 0x80) {
		v{{.Index}} = v{{.Index}}<<1 | 1;
	} else {
		memcpy(p, &v{{.Index}}, 8);
		int bit_count = 64 - __builtin_clzll(v{{.Index}});
		int tail_size = (((bit_count - 1) >> 3) + bit_count) >> 3;
		p += tail_size;
		v{{.Index}} = v{{.Index}} >> ((tail_size * 8) - 1) | 1;
		v{{.Index}} = v{{.Index}} << tail_size & 0xff;
	}
{{- if eq .WordShift 0}}
	word_t word{{.WordIndex}} = v{{.Index}};
{{- else}}
	word{{.WordIndex}} |= v{{.Index}} << {{.WordShift}};
{{- end -}}
